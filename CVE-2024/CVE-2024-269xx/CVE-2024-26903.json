{
  "id": "CVE-2024-26903",
  "sourceIdentifier": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
  "published": "2024-04-17T11:15:11.060",
  "lastModified": "2024-04-17T12:48:07.510",
  "vulnStatus": "Awaiting Analysis",
  "descriptions": [
    {
      "lang": "en",
      "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nBluetooth: rfcomm: Fix null-ptr-deref in rfcomm_check_security\n\nDuring our fuzz testing of the connection and disconnection process at the\nRFCOMM layer, we discovered this bug. By comparing the packets from a\nnormal connection and disconnection process with the testcase that\ntriggered a KASAN report. We analyzed the cause of this bug as follows:\n\n1. In the packets captured during a normal connection, the host sends a\n`Read Encryption Key Size` type of `HCI_CMD` packet\n(Command Opcode: 0x1408) to the controller to inquire the length of\nencryption key.After receiving this packet, the controller immediately\nreplies with a Command Completepacket (Event Code: 0x0e) to return the\nEncryption Key Size.\n\n2. In our fuzz test case, the timing of the controller's response to this\npacket was delayed to an unexpected point: after the RFCOMM and L2CAP\nlayers had disconnected but before the HCI layer had disconnected.\n\n3. After receiving the Encryption Key Size Response at the time described\nin point 2, the host still called the rfcomm_check_security function.\nHowever, by this time `struct l2cap_conn *conn = l2cap_pi(sk)->chan->conn;`\nhad already been released, and when the function executed\n`return hci_conn_security(conn->hcon, d->sec_level, auth_type, d->out);`,\nspecifically when accessing `conn->hcon`, a null-ptr-deref error occurred.\n\nTo fix this bug, check if `sk->sk_state` is BT_CLOSED before calling\nrfcomm_recv_frame in rfcomm_process_rx."
    },
    {
      "lang": "es",
      "value": "En el kernel de Linux, se resolvi\u00f3 la siguiente vulnerabilidad: Bluetooth: rfcomm: corrija null-ptr-deref en rfcomm_check_security Durante nuestras pruebas preliminares del proceso de conexi\u00f3n y desconexi\u00f3n en la capa RFCOMM, descubrimos este error. Comparando los paquetes de un proceso normal de conexi\u00f3n y desconexi\u00f3n con el caso de prueba que desencaden\u00f3 un informe KASAN. Analizamos la causa de este error de la siguiente manera: 1. En los paquetes capturados durante una conexi\u00f3n normal, el host env\u00eda un paquete `HCI_CMD` del tipo `Read Encryption Key Size` (c\u00f3digo de operaci\u00f3n de comando: 0x1408) al controlador para consultar la longitud. de clave de cifrado. Despu\u00e9s de recibir este paquete, el controlador responde inmediatamente con un paquete de comando completo (c\u00f3digo de evento: 0x0e) para devolver el tama\u00f1o de la clave de cifrado. 2. En nuestro caso de prueba fuzz, el tiempo de respuesta del controlador a este paquete se retras\u00f3 hasta un punto inesperado: despu\u00e9s de que las capas RFCOMM y L2CAP se desconectaran, pero antes de que se desconectara la capa HCI. 3. Despu\u00e9s de recibir la respuesta del tama\u00f1o de la clave de cifrado en el momento descrito en el punto 2, el host a\u00fan llam\u00f3 a la funci\u00f3n rfcomm_check_security. Sin embargo, en ese momento `struct l2cap_conn *conn = l2cap_pi(sk)-&gt;chan-&gt;conn;` ya se hab\u00eda lanzado, y cuando se ejecut\u00f3 la funci\u00f3n `return hci_conn_security(conn-&gt;hcon, d-&gt;sec_level, auth_type, d -&gt;out);`, espec\u00edficamente al acceder a `conn-&gt;hcon`, ocurri\u00f3 un error null-ptr-deref. Para corregir este error, verifique si `sk-&gt;sk_state` est\u00e1 BT_CLOSED antes de llamar a rfcomm_recv_frame en rfcomm_process_rx."
    }
  ],
  "metrics": {},
  "references": [
    {
      "url": "https://git.kernel.org/stable/c/2535b848fa0f42ddff3e5255cf5e742c9b77bb26",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/369f419c097e82407dd429a202cde9a73d3ae29b",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/3ead59bafad05f2967ae2438c0528d53244cfde5",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/567c0411dc3b424fc7bd1e6109726d7ba32d4f73",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/5f369efd9d963c1f711a06c9b8baf9f5ce616d85",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/5f9fe302dd3a9bbc50f4888464c1773f45166bfd",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/81d7d920a22fd58ef9aedb1bd0a68ee32bd23e96",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/8d1753973f598531baaa2c1033cf7f7b5bb004b0",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    }
  ]
}