{
  "id": "CVE-2024-57946",
  "sourceIdentifier": "416baaa9-dc9f-4396-8d5f-8c081fb06d67",
  "published": "2025-01-21T13:15:09.137",
  "lastModified": "2025-01-21T13:15:09.137",
  "vulnStatus": "Awaiting Analysis",
  "cveTags": [],
  "descriptions": [
    {
      "lang": "en",
      "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nvirtio-blk: don't keep queue frozen during system suspend\n\nCommit 4ce6e2db00de (\"virtio-blk: Ensure no requests in virtqueues before\ndeleting vqs.\") replaces queue quiesce with queue freeze in virtio-blk's\nPM callbacks. And the motivation is to drain inflight IOs before suspending.\n\nblock layer's queue freeze looks very handy, but it is also easy to cause\ndeadlock, such as, any attempt to call into bio_queue_enter() may run into\ndeadlock if the queue is frozen in current context. There are all kinds\nof ->suspend() called in suspend context, so keeping queue frozen in the\nwhole suspend context isn't one good idea. And Marek reported lockdep\nwarning[1] caused by virtio-blk's freeze queue in virtblk_freeze().\n\n[1] https://lore.kernel.org/linux-block/ca16370e-d646-4eee-b9cc-87277c89c43c@samsung.com/\n\nGiven the motivation is to drain in-flight IOs, it can be done by calling\nfreeze & unfreeze, meantime restore to previous behavior by keeping queue\nquiesced during suspend."
    },
    {
      "lang": "es",
      "value": "En el kernel de Linux, se ha resuelto la siguiente vulnerabilidad: virtio-blk: no mantener la cola congelada durante la suspensi\u00f3n del sistema. Commit 4ce6e2db00de (\"virtio-blk: Aseg\u00farese de que no haya solicitudes en virtqueues antes de eliminar vqs\") reemplaza la inactividad de la cola con el congelamiento de la cola en las devoluciones de llamadas de PM de virtio-blk. Y la motivaci\u00f3n es drenar las E/S en vuelo antes de suspender. El congelamiento de la cola de la capa de bloque parece muy \u00fatil, pero tambi\u00e9n es f\u00e1cil causar un bloqueo, como, por ejemplo, cualquier intento de llamar a bio_queue_enter() puede encontrarse con un bloqueo si la cola est\u00e1 congelada en el contexto actual. Hay todo tipo de -&gt;suspend() llamados en el contexto de suspensi\u00f3n, por lo que mantener la cola congelada en todo el contexto de suspensi\u00f3n no es una buena idea. Y Marek inform\u00f3 una advertencia de lockdep[1] causada por la cola congelada de virtio-blk en virtblk_freeze(). [1] https://lore.kernel.org/linux-block/ca16370e-d646-4eee-b9cc-87277c89c43c@samsung.com/ Dado que la motivaci\u00f3n es drenar las E/S en vuelo, se puede hacer llamando a congelar y descongelar, mientras tanto restaurar el comportamiento anterior manteniendo la cola inactiva durante la suspensi\u00f3n."
    }
  ],
  "metrics": {},
  "references": [
    {
      "url": "https://git.kernel.org/stable/c/12c0ddd6c551c1e438b087f874b4f1223a75f7ea",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/6dea8e3de59928974bf157dd0499d3958d744ae4",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/7678abee0867e6b7fb89aa40f6e9f575f755fb37",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/92d5139b91147ab372a17daf5dc27a5b9278e516",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/9ca428c6397abaa8c38f5c69133a2299e1efbbf2",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/9e323f856cf4963120e0e3892a84ef8bd764a0e4",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    },
    {
      "url": "https://git.kernel.org/stable/c/d738f3215bb4f88911ff4579780a44960c8e0ca5",
      "source": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"
    }
  ]
}